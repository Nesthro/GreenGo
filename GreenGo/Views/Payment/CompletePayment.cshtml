@model GreenGo.Models.PaymentViewModel
@{
    ViewBag.Title = "Complete Payment";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    body {
        background-color: #ffffff;
    }

    .payment-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 40px 20px;
        display: flex;
        gap: 40px;
    }

    .main-section {
        flex: 1;
    }

    .sidebar-section {
        width: 320px;
        flex-shrink: 0;
    }

    /* Progress Indicator */
    .progress-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 50px;
        position: relative;
        max-width: 500px;
    }

    .progress-line {
        position: absolute;
        top: 15px;
        left: 30px;
        right: 30px;
        height: 2px;
        background-color: #E0E0E0;
        z-index: 0;
    }

    .progress-line-fill {
        height: 100%;
        width: 100%;
        background-color: #7CB342;
    }

    .progress-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 1;
    }

    .progress-circle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;
        font-size: 14px;
        font-weight: 600;
        background-color: #E0E0E0;
        color: #fff;
    }

    .progress-circle.completed {
        background-color: #7CB342;
    }

    .progress-circle.current {
        background-color: #9E9E9E;
    }

    .progress-label {
        font-size: 13px;
        color: #666;
        white-space: nowrap;
    }

    .progress-step.current .progress-label {
        font-weight: 600;
        color: #333;
    }

    /* Section Header */
    .section-header {
        font-size: 20px;
        font-weight: 600;
        color: #333;
        margin-bottom: 25px;
    }

    /* Payment Card */
    .payment-card {
        background-color: #FAFAFA;
        border: 1px solid #E0E0E0;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 20px;
    }

    .payment-card h3 {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin: 0 0 20px 0;
    }

    /* Payment Methods */
    .payment-method {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px;
        border: 1px solid #E0E0E0;
        border-radius: 6px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.2s;
        background-color: #fff;
    }

    .payment-method:hover {
        border-color: #7CB342;
        background-color: #F9FFF9;
    }

    .payment-method input[type="radio"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .payment-method-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
    }

    .payment-method-text {
        flex: 1;
        font-size: 14px;
        color: #333;
        font-weight: 500;
    }

    .payment-method.selected {
        border-color: #7CB342;
        background-color: #F9FFF9;
    }

    .payment-method.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background-color: #F5F5F5;
    }

    .payment-info-banner {
        background-color: #FFF9E6;
        border: 1px solid #FFE082;
        border-radius: 6px;
        padding: 12px 15px;
        font-size: 13px;
        color: #666;
        display: flex;
        align-items: start;
        gap: 10px;
        margin-bottom: 20px;
    }

    .payment-info-banner::before {
        content: "🛡️";
        font-size: 16px;
    }

    /* Card Form */
    .card-form {
        margin-top: 20px;
        display: none;
    }

    .card-form.active {
        display: block;
    }

    .form-field {
        margin-bottom: 16px;
    }

    .form-field label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        color: #333;
        margin-bottom: 6px;
    }

    .form-field input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #E0E0E0;
        border-radius: 4px;
        font-size: 14px;
        color: #333;
        background-color: #fff;
    }

    .form-field input::placeholder {
        color: #999;
    }

    .form-field input:focus {
        outline: none;
        border-color: #7CB342;
    }

    .form-row {
        display: flex;
        gap: 15px;
    }

    .form-row .form-field {
        flex: 1;
    }

    /* Terms */
    .terms-note {
        font-size: 12px;
        color: #666;
        line-height: 1.6;
        margin: 20px 0;
    }

    .terms-note a {
        color: #1976D2;
        text-decoration: none;
    }

    /* Pay Button */
    .pay-section {
        text-align: center;
        margin-top: 30px;
    }

    .pay-btn {
        background-color: #7CB342;
        color: white;
        border: none;
        padding: 14px 40px;
        border-radius: 4px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s;
        width: 100%;
        max-width: 200px;
    }

    .pay-btn:hover {
        background-color: #689F38;
    }

    .pay-btn:disabled {
        background-color: #E0E0E0;
        cursor: not-allowed;
    }

    .pay-amount {
        display: block;
        font-size: 20px;
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
    }

    /* Sidebar */
    .summary-card {
        background-color: #FAFAFA;
        border: 1px solid #E0E0E0;
        border-radius: 8px;
        padding: 20px;
    }

    .summary-card h3 {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin: 0 0 20px 0;
    }

    .summary-section {
        margin-bottom: 20px;
    }

    .summary-section h4 {
        font-size: 14px;
        font-weight: 600;
        color: #333;
        margin: 0 0 12px 0;
    }

    .summary-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .summary-list li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        color: #666;
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .summary-list li span:first-child {
        flex: 1;
    }

    .summary-list li span:last-child {
        font-weight: 600;
        color: #333;
    }

    .summary-divider {
        border: none;
        border-top: 1px solid #E0E0E0;
        margin: 20px 0;
    }

    .summary-total {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 16px;
        font-weight: 600;
        color: #333;
    }

    .summary-total .amount {
        color: #7CB342;
        font-size: 18px;
    }


        .sidebar-section {
            width: 100%;
        }
    }
</style>

<div class="payment-container">
    <div class="main-section">
        <!-- Progress Header -->
        <div class="progress-header">
            <div class="progress-line">
                <div class="progress-line-fill"></div>
            </div>
            <div class="progress-step completed">
                <div class="progress-circle completed">✓</div>
                <span class="progress-label">Choose Booking</span>
            </div>
            <div class="progress-step completed">
                <div class="progress-circle completed">✓</div>
                <span class="progress-label">Enter Info</span>
            </div>
            <div class="progress-step current">
                <div class="progress-circle current"></div>
                <span class="progress-label">Pay</span>
            </div>
        </div>

        <h1 class="section-header">Complete Payment</h1>

        <form id="paymentForm" action="@Url.Action("ProcessCardPayment", "Payment")" method="post">
            @Html.AntiForgeryToken()

            <div class="payment-card">
                <h3>Choose Payment Method</h3>

                <div class="payment-info-banner">
                    All your information is fully encrypted, secure, and protected
                </div>

                <!-- Gcash -->
                <label class="payment-method disabled">
                    <input type="radio" name="paymentMethod" value="gcash" disabled>
                    <span class="payment-method-icon">💳</span>
                    <span class="payment-method-text">Gcash</span>
                </label>

                <!-- Credit/Debit Card -->
                <label class="payment-method" id="cardMethod">
                    <input type="radio" name="paymentMethod" value="card" checked>
                    <span class="payment-method-icon">💳</span>
                    <span class="payment-method-text">Credit/Debit Card</span>
                </label>

                <!-- Card Form -->
                <div class="card-form active" id="cardForm">
                    <div class="form-field">
                        <label for="cardNumber">Card Number</label>
                        <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                    </div>

                    <div class="form-field">
                        <label for="cardName">Cardholder Name</label>
                        <input type="text" id="cardName" name="cardName" placeholder="JOHN DOE" required>
                    </div>

                    <div class="form-row">
                        <div class="form-field">
                            <label for="expiryDate">Expiration Date</label>
                            <input type="text" id="expiryDate" name="expirationDate" placeholder="MM/YY" maxlength="5" required>
                        </div>
                        <div class="form-field">
                            <label for="cvv">Security Code</label>
                            <input type="text" id="cvv" name="securityCode" placeholder="CVV" maxlength="4" required>
                        </div>
                    </div>
                </div>

                <div class="terms-note">
                    By clicking "Pay", you accept our <a href="#">Terms & Conditions</a> and <a href="#">Cancellation policy</a>.
                </div>
            </div>

            <div class="pay-section">
                <span class="pay-amount">₱@Model.TotalFee.ToString("N2")</span>
                <button type="submit" class="pay-btn" id="payBtn">Pay</button>
            </div>
        </form>
    </div>

    <!-- Sidebar -->
    <div class="sidebar-section">
        <div class="summary-card">
            <h3>@Model.PlaceName</h3>

            <div class="summary-section">
                <h4>Single Ticket</h4>
                <ul class="summary-list">
                    <li>
                        <span>Planned participation date</span>
                        <span>05 Sep 2025</span>
                    </li>
                    <li>
                        <span>Quantity</span>
                        <span>University student x 1</span>
                    </li>
                </ul>
            </div>

            <hr class="summary-divider" />

            <div class="summary-total">
                <span>Total</span>
                <span class="amount">₱@Model.TotalFee.ToString("N2")</span>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            // Format card number
            $('#cardNumber').on('input', function () {
                var value = $(this).val().replace(/\s/g, '');
                var formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                $(this).val(formattedValue);
            });

            // Format expiry date
            $('#expiryDate').on('input', function () {
                var value = $(this).val().replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.slice(0, 2) + '/' + value.slice(2, 4);
                }
                $(this).val(value);
            });

            // Only allow numbers in CVV
            $('#cvv').on('input', function () {
                $(this).val($(this).val().replace(/\D/g, ''));
            });

            // Form submission
            $('#paymentForm').on('submit', function (e) {
                e.preventDefault();

                var cardNumber = $('#cardNumber').val().replace(/\s/g, '');
                var expiryDate = $('#expiryDate').val();
                var cvv = $('#cvv').val();

                // Basic validation
                if (cardNumber.length < 13 || cardNumber.length > 19) {
                    alert('Please enter a valid card number');
                    return false;
                }

                if (!/^\d{2}\/\d{2}$/.test(expiryDate)) {
                    alert('Please enter a valid expiry date (MM/YY)');
                    return false;
                }

                if (cvv.length < 3) {
                    alert('Please enter a valid security code');
                    return false;
                }

                // Show loading state
                $('#payBtn').prop('disabled', true).text('Processing...');

                // Submit form
                this.submit();
            });
        });
    </script>
}