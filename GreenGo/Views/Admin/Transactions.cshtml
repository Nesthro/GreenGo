@{
    ViewBag.Title = "Admin Transactions";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<link rel="stylesheet" href="~/Content/CSS/transactions.css" />

<div class="top-row">
    <div class="page-header">
        <h2>Transactions</h2>
    </div>
    <div class="top-right">
        <div class="searchbar">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input id="mainSearch" placeholder="Search" onkeyup="applyFilters()" />
        </div>
    </div>
</div>

<!-- STATS CARDS -->
<div class="stats-cards">
    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-title">Total Revenue</div>
            <div class="stat-value">5,423</div>
            <div class="stat-trend up">
                <i class="fa-solid fa-arrow-up"></i>
                12% this month
            </div>
        </div>
        <div class="stat-icon">
            <i class="fa-solid fa-wallet"></i>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-title">Successful Payment</div>
            <div class="stat-value">1,893</div>
            <div class="stat-trend up">
                <i class="fa-solid fa-arrow-up"></i>
                8% this month
            </div>
        </div>
        <div class="stat-icon">
            <i class="fa-solid fa-check-circle"></i>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-content">
            <div class="stat-title">Failed Transaction</div>
            <div class="stat-value">189</div>
        </div>
        <div class="stat-icon">
            <i class="fa-solid fa-desktop"></i>
        </div>
    </div>
</div>

<!-- TABLE SECTION -->
<div class="table-container">
    <div class="table-header">
        <div class="table-title">
            <h3>All Transactions</h3>
            <p class="table-subtitle">Transaction records within the system</p>
        </div>
        <div class="table-filters">
            <div class="searchbar-inline">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input id="tableSearch" placeholder="Search" onkeyup="applyFilters()" />
            </div>
            <div class="sort-dropdown">
                <label>Sort by:</label>
                <select id="statusFilter" onchange="applyFilters()">
                    <option value="all">All Transactions</option>
                    <option value="success">Successful</option>
                    <option value="failed">Failed</option>
                </select>
            </div>
        </div>
    </div>

    <table class="data-table">
        <thead>
            <tr>
                <th>Customer Name</th>
                <th>Phone Number</th>
                <th>Email</th>
                <th>Method of Payment</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
    </table>

    <div class="pagination">
        <div class="pagination-info" id="paginationInfo"></div>
        <div class="pagination-controls" id="paginationControls"></div>
    </div>
</div>

<script>
    // Sample transaction data
    const allTransactions = [
        { name: 'Jane Cooper', phone: '(+639) 12345789', email: 'janecooper@email.com', payment: 'GCash', status: 'success' },
        { name: 'Floyd Miles', phone: '(+639) 12345789', email: 'floydm@yahoo.com', payment: 'Credit Card', status: 'failed' },
        { name: 'Ronald Richards', phone: '(+639) 12345789', email: 'ronaldr@xasdas.com', payment: 'PayPal', status: 'failed' },
        { name: 'Marvin McKinney', phone: '(+639) 12345789', email: 'marvin@google.com', payment: 'GCash', status: 'success' },
        { name: 'Jerome Bell', phone: '(+639) 12345789', email: 'jeromebell@apple.com', payment: 'Cash', status: 'success' },
        { name: 'Kathryn Murphy', phone: '(+639) 12345789', email: 'kathryn@microsoft.com', payment: 'Bank Transfer', status: 'success' },
        { name: 'Jacob Jones', phone: '(+639) 12345789', email: 'jacobj@yahoo.com', payment: 'GCash', status: 'success' },
        { name: 'Kristin Watson', phone: '(+639) 12345789', email: 'kristin@facebook.com', payment: 'Credit Card', status: 'failed' },
        { name: 'Robert Fox', phone: '(+639) 98765432', email: 'robertfox@email.com', payment: 'PayPal', status: 'success' },
        { name: 'Jenny Wilson', phone: '(+639) 11223344', email: 'jennyw@gmail.com', payment: 'GCash', status: 'success' },
        { name: 'Courtney Henry', phone: '(+639) 55667788', email: 'courtney@outlook.com', payment: 'Cash', status: 'failed' },
        { name: 'Theresa Webb', phone: '(+639) 99887766', email: 'theresawebb@yahoo.com', payment: 'Credit Card', status: 'success' },
        { name: 'Cameron Williamson', phone: '(+639) 44556677', email: 'cameron@email.com', payment: 'Bank Transfer', status: 'success' },
        { name: 'Brooklyn Simmons', phone: '(+639) 33445566', email: 'brooklyn@gmail.com', payment: 'GCash', status: 'success' },
        { name: 'Leslie Alexander', phone: '(+639) 22334455', email: 'leslie@hotmail.com', payment: 'PayPal', status: 'failed' },
        { name: 'Guy Hawkins', phone: '(+639) 66778899', email: 'guyhawkins@email.com', payment: 'GCash', status: 'success' },
        { name: 'Eleanor Pena', phone: '(+639) 77889900', email: 'eleanor@microsoft.com', payment: 'Credit Card', status: 'success' },
        { name: 'Savannah Nguyen', phone: '(+639) 88990011', email: 'savannah@apple.com', payment: 'Cash', status: 'success' },
        { name: 'Arlene McCoy', phone: '(+639) 10293847', email: 'arlene@google.com', payment: 'Bank Transfer', status: 'failed' },
        { name: 'Annette Black', phone: '(+639) 56473829', email: 'annette@yahoo.com', payment: 'GCash', status: 'success' },
        { name: 'Ralph Edwards', phone: '(+639) 91827364', email: 'ralph@email.com', payment: 'PayPal', status: 'success' },
        { name: 'Cody Fisher', phone: '(+639) 73829104', email: 'codyfisher@gmail.com', payment: 'Credit Card', status: 'success' },
        { name: 'Albert Flores', phone: '(+639) 29384756', email: 'albertf@outlook.com', payment: 'GCash', status: 'failed' },
        { name: 'Bessie Cooper', phone: '(+639) 84756293', email: 'bessie@email.com', payment: 'Cash', status: 'success' },
        { name: 'Dianne Russell', phone: '(+639) 19283746', email: 'dianne@hotmail.com', payment: 'Bank Transfer', status: 'success' },
        { name: 'Devon Lane', phone: '(+639) 56473820', email: 'devonlane@yahoo.com', payment: 'PayPal', status: 'failed' },
        { name: 'Esther Howard', phone: '(+639) 38475692', email: 'esther@gmail.com', payment: 'GCash', status: 'success' },
        { name: 'Wade Warren', phone: '(+639) 74829301', email: 'wadewarren@email.com', payment: 'Credit Card', status: 'success' },
        { name: 'Darlene Robertson', phone: '(+639) 29384750', email: 'darlene@microsoft.com', payment: 'Cash', status: 'success' },
        { name: 'Soham Henry', phone: '(+639) 84756201', email: 'soham@apple.com', payment: 'Bank Transfer', status: 'failed' },
        { name: 'Emma Watson', phone: '(+639) 12398745', email: 'emmaw@email.com', payment: 'GCash', status: 'success' },
        { name: 'Oliver Smith', phone: '(+639) 45678912', email: 'oliver@gmail.com', payment: 'PayPal', status: 'success' },
        { name: 'Charlotte Brown', phone: '(+639) 78912345', email: 'charlotte@yahoo.com', payment: 'Credit Card', status: 'failed' },
        { name: 'William Jones', phone: '(+639) 32145698', email: 'william@outlook.com', payment: 'GCash', status: 'success' },
        { name: 'Sophia Davis', phone: '(+639) 65498732', email: 'sophia@email.com', payment: 'Cash', status: 'success' },
        { name: 'James Wilson', phone: '(+639) 98765123', email: 'jamesw@hotmail.com', payment: 'Bank Transfer', status: 'success' },
        { name: 'Isabella Garcia', phone: '(+639) 32198765', email: 'isabella@gmail.com', payment: 'PayPal', status: 'failed' },
        { name: 'Benjamin Martinez', phone: '(+639) 65432198', email: 'benjamin@email.com', payment: 'GCash', status: 'success' },
        { name: 'Mia Rodriguez', phone: '(+639) 98761234', email: 'mia@microsoft.com', payment: 'Credit Card', status: 'success' },
        { name: 'Lucas Hernandez', phone: '(+639) 12367894', email: 'lucas@apple.com', payment: 'Cash', status: 'success' },
        { name: 'Amelia Lopez', phone: '(+639) 45698721', email: 'amelia@yahoo.com', payment: 'Bank Transfer', status: 'failed' },
        { name: 'Henry Gonzalez', phone: '(+639) 78923456', email: 'henry@email.com', payment: 'GCash', status: 'success' },
        { name: 'Evelyn Perez', phone: '(+639) 32145987', email: 'evelyn@gmail.com', payment: 'PayPal', status: 'success' },
        { name: 'Alexander Sanchez', phone: '(+639) 65478932', email: 'alexander@outlook.com', payment: 'Credit Card', status: 'success' },
        { name: 'Harper Torres', phone: '(+639) 98732145', email: 'harper@email.com', payment: 'GCash', status: 'failed' },
        { name: 'Sebastian Rivera', phone: '(+639) 12398764', email: 'sebastian@hotmail.com', payment: 'Cash', status: 'success' },
        { name: 'Ella Flores', phone: '(+639) 45632198', email: 'ella@gmail.com', payment: 'Bank Transfer', status: 'success' },
        { name: 'Michael Gomez', phone: '(+639) 78965432', email: 'michael@email.com', payment: 'PayPal', status: 'success' },
        { name: 'Avery Diaz', phone: '(+639) 32178965', email: 'avery@microsoft.com', payment: 'GCash', status: 'failed' },
        { name: 'Daniel Cruz', phone: '(+639) 65412398', email: 'daniel@apple.com', payment: 'Credit Card', status: 'success' },
        { name: 'Sofia Reyes', phone: '(+639) 98745632', email: 'sofia@yahoo.com', payment: 'Cash', status: 'success' },
        { name: 'Matthew Morales', phone: '(+639) 12365987', email: 'matthew@email.com', payment: 'Bank Transfer', status: 'success' },
        { name: 'Emily Jimenez', phone: '(+639) 45698732', email: 'emily@gmail.com', payment: 'GCash', status: 'failed' },
        { name: 'David Ruiz', phone: '(+639) 78932165', email: 'david@outlook.com', payment: 'PayPal', status: 'success' },
        { name: 'Elizabeth Ortiz', phone: '(+639) 32165498', email: 'elizabeth@email.com', payment: 'Credit Card', status: 'success' },
        { name: 'Joseph Castro', phone: '(+639) 65498321', email: 'joseph@hotmail.com', payment: 'Cash', status: 'success' },
        { name: 'Mila Vargas', phone: '(+639) 98721654', email: 'mila@gmail.com', payment: 'Bank Transfer', status: 'failed' }
    ];

    // Pagination variables
    let currentPage = 1;
    const itemsPerPage = 8;
    let filteredData = [...allTransactions];

    // Initialize page
    function init() {
        render();
        renderPagination();
    }

    // Render table
    function render() {
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageData = filteredData.slice(start, end);

        let html = '';
        pageData.forEach(item => {
            const statusClass = item.status === 'success' ? 'success' : 'failed';
            const statusText = item.status === 'success' ? 'Successful' : 'Failed';

            html += '<tr>' +
                '<td>' + item.name + '</td>' +
                '<td>' + item.phone + '</td>' +
                '<td>' + item.email + '</td>' +
                '<td>' + item.payment + '</td>' +
                '<td><span class="status ' + statusClass + '">' + statusText + '</span></td>' +
                '</tr>';
        });

        document.getElementById('tableBody').innerHTML = html;

        // Update pagination info
        const total = filteredData.length;
        const showing = total > 0 ? start + 1 : 0;
        const to = Math.min(end, total);
        document.getElementById('paginationInfo').textContent = 'Showing items ' + showing + ' to ' + to + ' of ' + total + ' entries';
    }

    // Render pagination
    function renderPagination() {
        const totalPages = Math.ceil(filteredData.length / itemsPerPage);
        let html = '';

        // Previous button
        html += '<button class="page-btn" onclick="changePage(\'prev\')" ' + (currentPage === 1 ? 'disabled' : '') + '>';
        html += '<i class="fa-solid fa-chevron-left"></i></button>';

        // Page numbers
        const maxPages = 5;
        let start = Math.max(1, currentPage - Math.floor(maxPages / 2));
        let end = Math.min(totalPages, start + maxPages - 1);

        if (end - start < maxPages - 1) {
            start = Math.max(1, end - maxPages + 1);
        }

        if (start > 1) {
            html += '<button class="page-btn" onclick="changePage(1)">1</button>';
            if (start > 2) html += '<span>...</span>';
        }

        for (let i = start; i <= end; i++) {
            html += '<button class="page-btn ' + (i === currentPage ? 'active' : '') + '" onclick="changePage(' + i + ')">' + i + '</button>';
        }

        if (end < totalPages) {
            if (end < totalPages - 1) html += '<span>...</span>';
            html += '<button class="page-btn" onclick="changePage(' + totalPages + ')">' + totalPages + '</button>';
        }

        // Next button
        html += '<button class="page-btn" onclick="changePage(\'next\')" ' + (currentPage === totalPages ? 'disabled' : '') + '>';
        html += '<i class="fa-solid fa-chevron-right"></i></button>';

        document.getElementById('paginationControls').innerHTML = html;
    }

    // Change page
    function changePage(page) {
        const totalPages = Math.ceil(filteredData.length / itemsPerPage);

        if (page === 'prev' && currentPage > 1) currentPage--;
        else if (page === 'next' && currentPage < totalPages) currentPage++;
        else if (typeof page === 'number') currentPage = page;

        render();
        renderPagination();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Filter and search
    function applyFilters() {
        const searchTerm = (document.getElementById('tableSearch') || document.getElementById('mainSearch')).value.toUpperCase();
        const statusFilter = document.getElementById('statusFilter').value;

        filteredData = allTransactions.filter(item => {
            const matchSearch = item.name.toUpperCase().includes(searchTerm) ||
                item.email.toUpperCase().includes(searchTerm) ||
                item.phone.includes(searchTerm) ||
                item.payment.toUpperCase().includes(searchTerm);

            const matchStatus = statusFilter === 'all' || item.status === statusFilter;

            return matchSearch && matchStatus;
        });

        currentPage = 1;
        render();
        renderPagination();
    }

    // Start on page load
    window.addEventListener('DOMContentLoaded', init);
</script>

